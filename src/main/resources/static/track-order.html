<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Track Order - Project Anupam</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-pink: #ffc0cb;
      --light-pink: #ffe4e9;
      --dark-pink: #ff69b4;
      --text-dark: #4a4a4a;
    }

    body {
      background: linear-gradient(135deg, var(--light-pink) 0%, var(--primary-pink) 100%) fixed;
      font-family: 'Georgia', serif;
      color: var(--text-dark);
      min-height: 100vh;
    }

    .top-nav {
      background-color: white;
      border-bottom: 1px solid #e0e0e0;
      padding: 15px 0;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      margin-bottom: 30px;
    }

    .logo-text {
      font-weight: 700;
      font-size: 1.5rem;
      color: var(--dark-pink);
      letter-spacing: 2px;
      text-decoration: none;
    }

    .logo-subtitle {
      font-size: 0.6rem;
      color: var(--text-dark);
      letter-spacing: 3px;
    }

    .track-card {
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      padding: 40px;
      margin-bottom: 30px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }

    .track-card h2 {
      color: var(--text-dark);
      margin-bottom: 30px;
      text-align: center;
    }

    .search-box {
      max-width: 500px;
      margin: 0 auto 40px;
    }

    .form-control {
      border: 2px solid var(--primary-pink);
      border-radius: 10px 0 0 10px;
      padding: 15px;
      border-right: none;
    }

    .form-control:focus {
      border-color: var(--dark-pink);
      box-shadow: none;
    }

    .btn-track {
      background: var(--dark-pink);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 0 10px 10px 0;
      font-weight: 600;
      transition: all 0.3s;
    }

    .btn-track:hover {
      background: #ff1493;
      color: white;
    }

    .order-card {
      background: var(--light-pink);
      border: 2px solid var(--primary-pink);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
    }

    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--primary-pink);
    }

    .order-header h4 {
      margin: 0;
      color: var(--text-dark);
    }

    .status-badge {
      padding: 8px 20px;
      border-radius: 20px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: 0.85rem;
    }

    .status-pending {
      background: #ffc107;
      color: #000;
    }

    .status-confirmed {
      background: #17a2b8;
      color: white;
    }

    .status-processing {
      background: #6f42c1;
      color: white;
    }

    .status-shipped {
      background: #007bff;
      color: white;
    }

    .status-delivered {
      background: #28a745;
      color: white;
    }

    .status-cancelled {
      background: #dc3545;
      color: white;
    }

    .order-timeline {
      position: relative;
      padding-left: 40px;
      margin-top: 20px;
    }

    .timeline-item {
      position: relative;
      padding-bottom: 20px;
    }

    .timeline-item::before {
      content: '';
      position: absolute;
      left: -29px;
      top: 8px;
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background: #bdc3c7;
      border: 3px solid white;
    }

    .timeline-item.active::before {
      background: var(--dark-pink);
    }

    .timeline-item::after {
      content: '';
      position: absolute;
      left: -22px;
      top: 23px;
      width: 2px;
      height: 100%;
      background: #bdc3c7;
    }

    .timeline-item:last-child::after {
      display: none;
    }

    .timeline-item.active::after {
      background: var(--dark-pink);
    }

    .order-items {
      background: white;
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
    }

    .order-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid var(--light-pink);
    }

    .order-item:last-child {
      border-bottom: none;
    }

    .empty-state {
      text-align: center;
      padding: 50px 20px;
    }

    .empty-state i {
      font-size: 5rem;
      color: var(--primary-pink);
      margin-bottom: 20px;
    }

    @media (max-width: 768px) {
      .track-card {
        padding: 25px 20px;
      }

      .order-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
    }
  </style>
</head>

<body>
  <!-- Navigation -->
  <nav class="top-nav">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-6">
          <a href="index.html" class="logo-text text-decoration-none">
            PROJECT ANUPAM
            <div class="logo-subtitle">T H E &nbsp; I N C O M P A R A B L E</div>
          </a>
        </div>
        <div class="col-6 text-end">
          <a href="index.html" class="btn btn-outline-primary">
            <i class="fas fa-home me-2"></i>Home
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Track Order Content -->
  <div class="container">
    <div class="track-card">
      <h2><i class="fas fa-truck me-3"></i>Track Your Order</h2>

      <div class="search-box">
        <div class="input-group">
          <input type="email" class="form-control" id="emailInput" placeholder="Enter your email address" required>
          <button class="btn btn-track" onclick="trackOrder()">
            <i class="fas fa-search me-2"></i>Track
          </button>
        </div>
        <small class="text-muted d-block mt-2">
          <i class="fas fa-info-circle me-1"></i>
          Enter the email address you used during checkout
        </small>
      </div>

      <div id="ordersContainer"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/global.js"></script>
  <script>
    const statusSteps = {
      'PENDING': ['Pending', 'Confirmed', 'Processing', 'Shipped', 'Delivered'],
      'CONFIRMED': ['Confirmed', 'Processing', 'Shipped', 'Delivered'],
      'PROCESSING': ['Processing', 'Shipped', 'Delivered'],
      'SHIPPED': ['Shipped', 'Delivered'],
      'DELIVERED': ['Delivered'],
      'CANCELLED': ['Cancelled']
    };

    // Track order
    async function trackOrder() {
      const email = document.getElementById('emailInput').value.trim();

      if (!email) {
        alert('Please enter your email address');
        return;
      }

      // Using global.js apiCall method
      const result = await apiCall(`/public/orders/track?email=${encodeURIComponent(email)}`);

      if (result && result.success && result.data.length > 0) {
        displayOrders(result.data);
      } else {
        showEmptyState();
      }
    }

    // Display orders
    function displayOrders(orders) {
      const container = document.getElementById('ordersContainer');

      container.innerHTML = orders.map(order => `
                <div class="order-card">
                    <div class="order-header">
                        <div>
                            <h4>Order #${order.id}</h4>
                            <p class="mb-0 text-muted">
                                <i class="fas fa-calendar me-2"></i>
                                ${new Date(order.createdAt).toLocaleDateString('en-IN', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      })}
                            </p>
                        </div>
                        <div>
                            <span class="status-badge status-${order.status.toLowerCase()}">
                                ${order.status}
                            </span>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong><i class="fas fa-user me-2"></i>Customer:</strong>
                            <p class="mb-1">${order.customerName}</p>
                            <p class="mb-1 text-muted">${order.customerEmail}</p>
                            <p class="mb-0 text-muted">${order.customerPhone}</p>
                        </div>
                        <div class="col-md-6">
                            <strong><i class="fas fa-map-marker-alt me-2"></i>Delivery Address:</strong>
                            <p class="mb-0">${order.address}</p>
                        </div>
                    </div>

                    <div class="order-timeline">
                        ${generateTimeline(order.status)}
                    </div>

                    <div class="order-items">
                        <h5 class="mb-3"><i class="fas fa-shopping-bag me-2"></i>Order Items</h5>
                        ${order.orderItems.map(item => `
                            <div class="order-item">
                                <div>
                                    <strong>${item.productName}</strong>
                                    <p class="mb-0 text-muted small">by ${item.studentName}</p>
                                    <p class="mb-0 small">Qty: ${item.quantity} × ₹${item.price.toFixed(2)}</p>
                                </div>
                                <div class="text-end">
                                    <strong>₹${item.subtotal.toFixed(2)}</strong>
                                </div>
                            </div>
                        `).join('')}
                        <div class="order-item">
                            <strong>Total Amount:</strong>
                            <strong style="color: var(--dark-pink); font-size: 1.3rem;">₹${order.totalAmount.toFixed(2)}</strong>
                        </div>
                    </div>
                </div>
            `).join('');
    }

    // Generate timeline based on status
    function generateTimeline(currentStatus) {
      const allSteps = ['PENDING', 'CONFIRMED', 'PROCESSING', 'SHIPPED', 'DELIVERED'];
      const currentIndex = allSteps.indexOf(currentStatus);

      if (currentStatus === 'CANCELLED') {
        return `
                    <div class="timeline-item active">
                        <strong>Order Cancelled</strong>
                        <p class="text-muted mb-0">Your order has been cancelled</p>
                    </div>
                `;
      }

      return allSteps.map((step, index) => {
        const isActive = index <= currentIndex;
        const statusLabels = {
          'PENDING': 'Order Placed',
          'CONFIRMED': 'Order Confirmed',
          'PROCESSING': 'Processing',
          'SHIPPED': 'Shipped',
          'DELIVERED': 'Delivered'
        };

        return `
                    <div class="timeline-item ${isActive ? 'active' : ''}">
                        <strong>${statusLabels[step]}</strong>
                        <p class="text-muted mb-0">
                            ${isActive ?
            (index === currentIndex ? 'Current status' : 'Completed') :
            'Pending'}
                        </p>
                    </div>
                `;
      }).join('');
    }

    // Show empty state
    function showEmptyState() {
      document.getElementById('ordersContainer').innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-search"></i>
                    <h4>No Orders Found</h4>
                    <p class="text-muted">We couldn't find any orders with this email address.</p>
                    <p class="text-muted">Please check your email and try again.</p>
                </div>
            `;
    }

    // Auto-fill email from URL parameter
    const urlParams = new URLSearchParams(window.location.search);
    const emailParam = urlParams.get('email');
    if (emailParam) {
      document.getElementById('emailInput').value = emailParam;
      trackOrder();
    }

    // Allow Enter key to track
    document.getElementById('emailInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        trackOrder();
      }
    });
  </script>
</body>

</html>